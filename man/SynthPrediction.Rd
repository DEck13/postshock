% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/SynthPrediction.R
\name{SynthPrediction}
\alias{SynthPrediction}
\title{Synthetic Prediction with Donor Balancing and Shock Adjustment}
\usage{
SynthPrediction(
  Y_series_list,
  covariates_series_list,
  shock_time_vec,
  shock_length_vec,
  k = 1,
  dbw_scale = TRUE,
  dbw_center = TRUE,
  dbw_indices = NULL,
  princ_comp_input = min(length(shock_time_vec), ncol(covariates_series_list[[1]])),
  covariate_indices = NULL,
  geometric_sets = NULL,
  days_before_shocktime_vec = NULL,
  arima_order = NULL,
  seasonal = FALSE,
  seasonal_order = NULL,
  seasonal_period = NULL,
  user_ic_choice = c("aicc", "aic", "bic")[1],
  stepwise = TRUE,
  approximation = TRUE,
  plots = TRUE,
  display_ground_truth_choice = FALSE,
  penalty_lambda = 0,
  penalty_normchoice = "l1"
)
}
\arguments{
\item{Y_series_list}{List of time series (e.g., \code{xts}). \code{[[1]]} is
the target; \code{[[2]]..[[n+1]]} are donors.}

\item{covariates_series_list}{List of time series aligned with
\code{Y_series_list}. Used for DBW and as optional \code{xreg} for the target.
You may pass \code{Y_series_list} here as a simple baseline.}

\item{shock_time_vec}{Vector of shock start times. Each element can be an
index value present in the corresponding series or a positive integer row
number. Length must equal \code{length(Y_series_list)}.}

\item{shock_length_vec}{Integer vector (same length as \code{Y_series_list})
giving the length (in rows) of the post-shock window used to estimate
donor fixed effects.}

\item{k}{Integer forecast horizon for the target series.}

\item{dbw_scale, dbw_center}{Logical flags forwarded to \code{dbw} when donor
weights are estimated.}

\item{dbw_indices}{Integer vector of covariate columns used by \code{dbw}.
Defaults to all columns of the first covariate matrix when \code{NULL}.}

\item{princ_comp_input}{Optional PCA dimension for \code{dbw}; forwarded only.}

\item{covariate_indices}{Integer vector of columns from
\code{covariates_series_list[[i]]} to include as \code{xreg} (lagged for the
target; contemporaneous for donors) in ARIMA fits. If \code{NULL}, donors use
only the post-shock indicator and the target uses no \code{xreg}.}

\item{geometric_sets, days_before_shocktime_vec}{Reserved (ignored).}

\item{arima_order}{Optional fixed ARIMA order \code{c(p,d,q)} for all series.
If \code{NULL}, \code{forecast::auto.arima} is used.}

\item{seasonal}{Logical, whether seasonal ARIMA is allowed/requested.}

\item{seasonal_order}{Optional seasonal order \code{c(P,D,Q)} when
\code{seasonal=TRUE} and \code{arima_order} is supplied.}

\item{seasonal_period}{Optional seasonal period; auto-detected if \code{NULL}
and \code{seasonal=TRUE}.}

\item{user_ic_choice}{Information criterion for \code{auto.arima}
(\code{"aicc"}, \code{"aic"}, or \code{"bic"}).}

\item{stepwise, approximation}{Passed to \code{forecast::auto.arima}.}

\item{plots}{Logical; if \code{TRUE} and a function named
\code{plot_maker_synthprediction} is found via \code{get0()}, it is called.}

\item{display_ground_truth_choice}{Logical; forwarded to the plotting helper
if it exists.}

\item{penalty_lambda}{Numeric L1/L2 penalty weight forwarded to \code{dbw}.}

\item{penalty_normchoice}{Character \code{"l1"} or \code{"l2"}; forwarded to
\code{dbw}.}
}
\value{
A list with elements:
\itemize{
\item \code{linear_combinations}: numeric donor weights \eqn{W}.
\item \code{predictions}: list with numeric vectors
\code{unadjusted}, \code{adjusted}, \code{arithmetic_mean}.
\item \code{loss}: optional list of SSE vs. ground truth (if provided in env).
\item \code{meta}: list with metadata (weights status, shock info, ARIMA orders, IC used).
}
}
\description{
Builds k-step-ahead forecasts for a target time series by:
(1) estimating post-shock fixed effects on each donor via (S)ARIMA with an
indicator regressor, (2) combining donor shock effects with donor weights
(uniform or from \code{\link{dbw}}), and (3) adjusting the target ARIMA
forecast by the weighted shock effect. Designed for aligned time indices.
}
\examples{
\donttest{
library(xts)
set.seed(1)
T <- 80
idx <- seq.Date(as.Date("2022-01-01"), by="day", length.out=T)
y1 <- xts(rnorm(T), idx)  # target
y2 <- xts(rnorm(T), idx)  # donor 1
y3 <- xts(rnorm(T), idx)  # donor 2
Y <- list(y1, y2, y3)
X <- list(y1, y2, y3)     # simple baseline
shock_time  <- rep(idx[60], length(Y))
shock_len   <- rep(5L, length(Y))
out <- SynthPrediction(
  Y_series_list=Y, covariates_series_list=X,
  shock_time_vec=shock_time, shock_length_vec=shock_len,
  k=3, plots=FALSE
)
str(out$predictions)
}

}
